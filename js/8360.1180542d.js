"use strict";(self["webpackChunkvue3_test"]=self["webpackChunkvue3_test"]||[]).push([[8360],{33969:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var i=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"audio_box_s"},[t("div",[t("div",{staticClass:"audiotitlex"},[e._m(0),t("div",{staticClass:"fileName_box"},[e._v(" "+e._s(e.fileName)+" ")])])]),t("div",{staticClass:"_box"},[t("div",{staticClass:"image_box_row"},[t("el-image",{staticClass:"read_leftt1_imgx",attrs:{src:e.select_index,fit:"contain"}})],1)]),t("div",{staticClass:"top"},[t("audioPlay",{ref:"audio",attrs:{url:e.goodsFilePath,title:e.fileName}})],1)])])},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"img_box"},[t("img",{staticClass:"img_box",attrs:{src:s(79052)}})])}],r=(s(57658),s(7742)),a=s(86264),l=s(85837),n=s(39570),d={components:{videoPlayer:a.videoPlayer,audioPlay:n.Z},data(){return{fileName:"",goodsFileId:void 0,goodsId:this.$route.query.goodsId,filesId:"",relevanceId:void 0,resource:void 0,resourceType:void 0,teachInstId:void 0,goodsFilePath:"",readdefault:0,loading:!1,play:!1,setInterval2:void 0,TimeParameter:10}},props:{select_index:String},created(){},destroyed(){this.closeTime()},methods:{selectTimeParameter(){(0,r.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},closeTime(){clearInterval(this.setInterval2),this.setInterval2=null},updateOcDownloadReading(){(0,r.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},tabbook(e){this.$refs.audio.onPlayerEnded(),this.loading=this.$loading({lock:!0}),this.goodsFileId=e.filesId,this.fileName=e.sourceName,this.filesId=e.filesId,(0,r.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((t=>{this.loading.close();let s=t.data;s&&this.buys(e,s)}))},buys(e,t){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,l.kx)({relevanceId:this.goodsId,type:this.payType}).then((s=>{t.hasPermission?(this.goodsFilePath=t.filePath,this.selectTimeParameter()):"1"==s.data&&"2"==e.sourceStatus?(this.Trial=!0,this.goodsFilePath=t.filePath):(this.goodsFilePath="",this.checkIsBuys())}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,l.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})}}},h=d,c=s(1001),u=(0,c.Z)(h,i,o,!1,null,"0941c5e9",null),g=u.exports},42658:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video_box_s"},[t("div",{staticClass:"video_box"},[t("div",{staticClass:"audiotitlex"},[e._m(0),t("div",{staticClass:"fileName_box"},[e._v(" "+e._s(e.fileName)+" ")])]),t("div",{staticClass:"video_con"},[e.goodsFilePath?t("el-image",{attrs:{src:e.goodsFilePath,"preview-src-list":e.srcList}}):e._e()],1)])])},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"img_box"},[t("img",{staticClass:"img_box",attrs:{src:s(29861)}})])}],r=(s(57658),s(7742)),a=s(85837),l={data(){return{fileName:"",goodsId:this.$route.query.goodsId,filesId:"",goodsFilePath:"",bookdetail:{},sourceList:[],readdefault:0,item:void 0,index:void 0,srcList:[],loading:!1,setInterval2:void 0,TimeParameter:10}},created(){this.stopEvent()},destroyed(){this.closeTime()},methods:{stopEvent(){document.oncontextmenu=function(e){return!1}},selectTimeParameter(){(0,r.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},closeTime(){clearInterval(this.setInterval2),this.setInterval2=null},updateOcDownloadReading(){(0,r.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},tabbook(e){this.fileName=e.sourceName,this.filesId=e.filesId,this.loading=this.$loading({lock:!0}),(0,r.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((t=>{this.loading.close();let s=t.data;s&&this.buys(e,s)}))},buys(e,t){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,a.kx)({relevanceId:this.goodsId,type:this.payType}).then((s=>{t.hasPermission?(this.goodsFilePath=t.filePath,this.srcList.push(this.goodsFilePath),this.selectTimeParameter()):"1"==s.data&&"2"==e.sourceStatus?(this.Trial=!0,this.goodsFilePath=t.filePath,this.srcList.push(this.goodsFilePath)):(this.goodsFilePath="",this.checkIsBuys())}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,a.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})}}},n=l,d=s(1001),h=(0,d.Z)(n,i,o,!1,null,"3eca57f4",null),c=h.exports},92190:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video_box_s"},[t("div",{staticClass:"video_box"},[t("div",{staticClass:"audiotitlex"},[e._m(0),t("div",{staticClass:"fileName_box"},[e._v(e._s(e.fileName))])]),t("div",{staticClass:"video_con",on:{contextmenu:function(t){return t.preventDefault(),e.menuPlayer()}}},[e.goodsFilePath?t("video-player",{ref:"videoPlayer",staticClass:"video-player vjs-custom-skin",attrs:{playsinline:!0,options:e.playerOptions}}):e._e()],1)])])},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"img_box"},[t("img",{staticClass:"img_box",attrs:{src:s(11397)}})])}],r=(s(57658),s(7742)),a=(s(57976),s(86264)),l=s(85837),n={components:{videoPlayer:a.videoPlayer},computed:{playerOptions(){const e={playbackRates:[.5,.8,1,1.5,2,3,5],autoplay:!1,muted:!1,loop:!1,preload:"auto",language:"zh-CN",aspectRatio:"16:9",fluid:!1,sources:[{type:"video/"+this.fileType,src:this.goodsFilePath}],poster:"",notSupportedMessage:"此视频暂无法播放...",controlBar:{timeDivider:!0,durationDisplay:!0,remainingTimeDisplay:!1,fullscreenToggle:!0}};return e}},data(){return{fileName:"",goodsId:this.$route.query.goodsId,filesId:"",goodsFilePath:"",bookdetail:{},sourceList:[],readdefault:0,loading:!1,wsitch:!0,isBookshelf:!1,fileType:"mp4",setInterval2:void 0,TimeParameter:10}},created(){$(document).ready((function(){$("#video").bind("contextmenu",(function(){return!1}))}))},destroyed(){this.closeTime()},methods:{selectTimeParameter(){(0,r.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},closeTime(){clearInterval(this.setInterval2),this.setInterval2=null},updateOcDownloadReading(){(0,r.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},tabbook(e){this.filesId=e.filesId,this.loading=this.$loading({lock:!0}),this.fileName=e.sourceName,(0,r.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((t=>{this.loading.close();let s=t.data;s&&this.buys(e,s)}))},buys(e,t){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,l.kx)({relevanceId:this.goodsId,type:this.payType}).then((s=>{t.hasPermission?(this.goodsFilePath=t.filePath,this.selectTimeParameter()):"1"==s.data&&"2"==e.sourceStatus?(this.Trial=!0,this.goodsFilePath=t.filePath):(this.goodsFilePath="",this.checkIsBuys())}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,l.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})},menuPlayer(){}}},d=n,h=s(1001),c=(0,h.Z)(d,i,o,!1,null,"0c00aea6",null),u=c.exports},80503:function(e,t,s){s.r(t),s.d(t,{default:function(){return de}});var i=function(){var e=this,t=e._self._c;return t("div",{class:"epub_box "+e.backclass},[t("div",{staticClass:"epub_box_c",staticStyle:{"margin-top":"15px"}},[t("div",{staticClass:"read_left_box"},[t("div",{staticClass:"read_left"},[t("div",{staticClass:"title theme-title"},[e._v("商品详情")]),e.coverFiles[0]?t("div",{staticClass:"read_leftt1"},[t("el-image",{staticClass:"read_leftt1_img",attrs:{src:e.coverFiles[0].fullUrl,fit:"contain"}}),t("p",{staticClass:"ellipsis-aRow"},[t("span",[e._v(e._s(e.callDictionaries(e.goodsTypeList,e.bookdetail.resourceType)))]),e._v(" "+e._s(e.bookdetail.goodsTitle)+" ")])],1):e._e(),t("div",{staticClass:"read_leftt2"},["looseleafOrtextbook"!=e.bookdetail.goodsType?t("li",[e._v(" 作者："+e._s(e.bookdetail.author||"-")+" ")]):e._e(),"reference"!==e.bookdetail.goodsType&&"other"!==e.bookdetail.goodsType?t("li",[e._v(" ISBN: "+e._s(e.bookdetail.isbn||"-")+" ")]):e._e(),"looseleafOrtextbook"!=e.bookdetail.goodsType?t("li",[e._v(" 出版社："+e._s(e.bookdetail.publishingHouse||"-")+" ")]):e._e(),"reference"!==e.bookdetail.goodsType&&"other"!==e.bookdetail.goodsType&&"looseleafOrtextbook"!=e.bookdetail.goodsType?t("li",[e._v(" 出版时间："+e._s(e.bookdetail.publishDate||"-")+" ")]):e._e(),t("li",[e._v("教学属性："+e._s(e.bookdetail.teachPropertyAllStr||"-"))]),t("li",[e._v("提供机构："+e._s(e.bookdetail.instName||"-"))])]),t("div",{staticClass:"read_leftt3"},[t("p",{staticClass:"ellipsis-twoRow"},[e._v(" "+e._s(e.bookdetail.authorRecommendation)+" ")])])]),t("div",{staticClass:"read_left2"},[t("div",{staticClass:"title theme-title color_F6A200"},[e._v("资源文件")]),t("div",{staticClass:"read_left2_ul"},e._l(e.sourceList,(function(s,i){return t("li",{key:i,class:i==e.readdefault?"active":"",on:{click:function(t){return e.tabbook(s,i)}}},[t("p",{staticClass:"ellipsis-aRow"},[e._v(" "+e._s(s.sourceName)+"."+e._s(s.fileType)+" ")]),"1"===s.sourceStatus?t("span",{staticClass:"mf"},[e._v("免费")]):e._e(),"0"===s.sourceStatus?t("span",{staticClass:"ff"},[e._v("付费")]):e._e(),"2"===s.sourceStatus?t("span",{staticClass:"mf"},[e._v("试读")]):e._e()])})),0)])]),t("div",{staticClass:"componentsview"},["epub"===e.readtype?t("epubread",{ref:"epubread"}):e._e(),"pdf"===e.readtype?t("pdfread",{ref:"pdfread"}):e._e(),"pwe"===e.readtype?t("pweread",{ref:"pweread"}):e._e(),"audioread"===e.readtype?t("audioread",{ref:"audioread",attrs:{select_index:e.cover_fullUrl}}):e._e(),"img"===e.readtype?t("imgread",{ref:"imgread"}):e._e(),"videoread"===e.readtype?t("videoread",{ref:"videoread"}):e._e(),"zipread"===e.readtype?t("zipread",{ref:"zipread"}):e._e(),"htmlread"===e.readtype?t("htmlread",{ref:"htmlread"}):e._e(),"leafletread"===e.readtype?t("leaflet",{ref:"leafletread"}):e._e()],1)]),t("integralBox",{ref:"integralBox",staticClass:"topLeft"})],1)},o=[],r=s(97107),a=s(7742),l=s(54526),n=s(85837),d=(s(57976),function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"read_center_box",attrs:{id:"read_center_box"}},[t("div",{staticClass:"read_top"},[t("div",{staticClass:"dqyd"},[t("img",{attrs:{src:s(14842)}}),e._v(" 您已阅读"+e._s(e._f("stohms")(e.readingTimeCount)))]),t("div",{staticClass:"bookmarks"},[t("img",{directives:[{name:"show",rawName:"v-show",value:-1===JSON.stringify(e.bookmarkList).indexOf(e.currentCfi),expression:"JSON.stringify(bookmarkList).indexOf(currentCfi) === -1"}],attrs:{src:s(44847),alt:""},on:{click:function(t){return e.bookmarksBtn("add")}}}),t("img",{directives:[{name:"show",rawName:"v-show",value:-1!==JSON.stringify(e.bookmarkList).indexOf(e.currentCfi),expression:"JSON.stringify(bookmarkList).indexOf(currentCfi) !== -1"}],attrs:{src:s(12726),alt:""},on:{click:function(t){return e.bookmarksBtn("delete")}}})])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.boxViewer,expression:"boxViewer"}],attrs:{id:"box"}},[t("div",{staticClass:"scrolled",attrs:{id:"viewer"}})])]),t("div",{staticClass:"read_right_box"},[t("div",{staticClass:"read_right_box1"},[t("el-popover",{attrs:{placement:"left",width:"500",trigger:"click"},model:{value:e.searchVisible,callback:function(t){e.searchVisible=t},expression:"searchVisible"}},[t("i",{staticClass:"el-icon-error",staticStyle:{float:"right","margin-top":"-5px","margin-bottom":"5px",cursor:"pointer"},on:{click:function(t){e.searchVisible=!1}}}),t("div",{staticClass:"mulu rmulu"},[t("div",[t("div",{staticClass:"custom-search",staticStyle:{border:"none"}},[t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.searchInput,expression:"searchInput",modifiers:{trim:!0}}],staticClass:"custom-input",attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.searchInput},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.xsearch(e.searchInput)},input:function(t){t.target.composing||(e.searchInput=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),t("el-button",{staticClass:"custom-button",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.xsearch(e.searchInput)}}},[e._v("搜索 ")])],1),e._l(e.searchList,(function(s,i){return t("div",{key:i},[t("div",{directives:[{name:"show",rawName:"v-show",value:!(i>0)||s.excerpt!=e.searchList[i-1].excerpt,expression:"\n                  index > 0\n                    ? item.excerpt != searchList[index - 1].excerpt\n                    : true\n                "}],staticClass:"searchList_box",domProps:{innerHTML:e._s(s.excerpt)},on:{click:function(t){return e.searchcfi(s)}}})])}))],2)]),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(39586)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(39586)}}):e._e(),t("p",[e._v("搜索")])])]),t("el-popover",{attrs:{placement:"left",width:"500",trigger:"click"},model:{value:e.muluvisible,callback:function(t){e.muluvisible=t},expression:"muluvisible"}},[t("i",{staticClass:"el-icon-error",staticStyle:{float:"right","margin-top":"-5px","margin-bottom":"5px",cursor:"pointer"},on:{click:function(t){e.muluvisible=!1}}}),t("div",{staticClass:"mulu rmulu"},e._l(e.mulu,(function(s,i){return t("li",{key:i},[t("p",{staticClass:"ellipsis-aRow",on:{click:function(t){return e.clickmulu(s)}}},[e._v(" "+e._s(s.label)+" ")]),s.subitems.length?t("ul",{staticClass:"twomulu"},e._l(s.subitems,(function(s,i){return t("li",{key:i,on:{click:function(t){return e.clickmulu(s)}}},[e._v(" "+e._s(s.label)+" ")])})),0):e._e()])})),0),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(85069)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(16825)}}):e._e(),t("p",[e._v("目录")])])]),t("el-popover",{attrs:{placement:"left",width:"350",trigger:"click"},model:{value:e.shezhivisible,callback:function(t){e.shezhivisible=t},expression:"shezhivisible"}},[t("i",{staticClass:"el-icon-error",staticStyle:{float:"right","margin-top":"-5px","margin-bottom":"5px",cursor:"pointer"},on:{click:function(t){e.shezhivisible=!1}}}),t("div",{staticClass:"shezhi"},[t("li",[t("p",[e._v("阅读主题")]),t("div",{staticClass:"xz_box ydzt"},e._l(e.backgroundList,(function(s,i){return t("span",{key:i,class:s.backclass===e.backclass?"active":"",style:"background: "+s.color,on:{click:function(t){e.changezt(s),e.result(),e.shezhisave()}}})})),0)]),t("li",[t("p",[e._v("正文字体")]),t("div",{staticClass:"xz_box zwzt"},e._l(e.zwztList,(function(s,i){return t("span",{key:i,class:e.zwzt===s.value?"active":"",on:{click:function(t){e.changezwzt(s.value),e.shezhisave()}}},[e._v(e._s(s.label))])})),0)]),t("li",[t("p",[e._v("字体大小")]),t("div",{staticClass:"xz_box ztdx"},[t("el-input-number",{attrs:{size:"small",min:12,max:36,label:"描述文字",step:2,"step-strictly":""},on:{change:function(t){return e.numchange()},blur:(t,s)=>{e.blurNumber(t,"num")}},model:{value:e.num,callback:function(t){e.num=t},expression:"num"}})],1)])]),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(40103)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(89001)}}):e._e(),t("p",[e._v("设置")])])]),t("el-popover",{attrs:{placement:"left",width:"500",trigger:"click"},model:{value:e.bijivisible,callback:function(t){e.bijivisible=t},expression:"bijivisible"}},[t("i",{staticClass:"el-icon-error",staticStyle:{float:"right","margin-top":"-5px","margin-bottom":"5px",cursor:"pointer"},on:{click:function(t){e.bijivisible=!1}}}),t("div",{staticClass:"mulu"},[e._l(e.highlights,(function(s,i){return t("li",{key:i},[t("p",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.highlightClick(s.textRange)}}},[e._v(" "+e._s(s.noteContent)+" ")]),t("div",{staticClass:"sjcz"},[t("p",{staticStyle:{float:"left"}},[e._v(e._s(s.createTime))]),t("div",{staticClass:"mulu_liright"},[t("span",{on:{click:function(t){return e.updateNote(i)}}},[t("i",{staticClass:"el-icon-edit"}),e._v(" 修改 ")]),t("span",{on:{click:function(t){return e.removeNote(s.textRange,i)}}},[t("i",{staticClass:"el-icon-delete"}),e._v(" 删除 ")])])])])})),0==e.highlights?t("noData"):e._e()],2),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(43944)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(11297)}}):e._e(),t("p",[e._v("笔记")])])]),t("el-popover",{attrs:{placement:"left",width:"500",trigger:"click"},model:{value:e.bookmarkVisible,callback:function(t){e.bookmarkVisible=t},expression:"bookmarkVisible"}},[t("i",{staticClass:"el-icon-error",staticStyle:{float:"right","margin-top":"-5px","margin-bottom":"5px",cursor:"pointer"},on:{click:function(t){e.bookmarkVisible=!1}}}),t("div",{staticClass:"mulu"},[e._l(e.bookmarkList,(function(s,i){return t("li",{key:i},[t("p",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.highlightClick(s.textRange)}}},[e._v(" "+e._s(e.getMuluValue(s.noteContent))+" ")]),t("div",{staticClass:"sjcz"},[t("p",{staticStyle:{float:"left"}},[e._v(e._s(s.createTime))]),t("div",{staticClass:"mulu_liright"},[t("span",{on:{click:function(t){return e.deleteBookmark(s.id)}}},[t("i",{staticClass:"el-icon-delete"}),e._v(" 删除 ")])])])])})),0==e.bookmarkList.length?t("noData"):e._e()],2),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(9180)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(40803)}}):e._e(),t("p",[e._v("书签")])])]),t("li",{class:0==this.$route.query.typeName&&!0===e.isBookshelf?"cursorDefault":"",on:{click:function(t){return e.addBookshelf()}}},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(86224)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(84798)}}):e._e(),e.isBookshelf?t("p",[e._v("已加书架")]):e._e(),e.isBookshelf?e._e():t("p",[e._v("加入书架")])]),t("li",{on:{click:e.changeflow}},["zt_heise"!==e.backclass?t("div",["auto"===e.flow?t("img",{attrs:{src:s(14407)}}):e._e(),"auto"!==e.flow?t("img",{attrs:{src:s(30730)}}):e._e()]):e._e(),"zt_heise"===e.backclass?t("div",["auto"===e.flow?t("img",{attrs:{src:s(23270)}}):e._e(),"auto"!==e.flow?t("img",{attrs:{src:s(45342)}}):e._e()]):e._e(),t("p",[e._v(e._s("auto"===e.flow?"滑动阅读":"翻页阅读"))])])],1),t("div",{staticClass:"read_right_box2"},[t("div",{attrs:{id:"prev"}},[t("img",{attrs:{src:s(90194)},on:{click:function(t){return e.prevPage()}}})]),t("div",{attrs:{id:"next"}},[t("img",{attrs:{src:s(5130)},on:{click:function(t){return e.nextPage()}}})])])]),t("div",{staticClass:"slider_box"},[t("el-slider",{attrs:{id:"slider",max:e.sliderMax,"format-tooltip":e.sliderFormat,"show-tooltip":e.flag},on:{change:e.onProgressChange},model:{value:e.progress,callback:function(t){e.progress=t},expression:"progress"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showAddNotes,expression:"showAddNotes"}],staticClass:"add-notes-bookmarks-pc",style:{top:e.topDistance+"px",left:"calc(50% + 50px)"}},[t("div",{staticClass:"item-box"},[t("img",{attrs:{src:s(19540),alt:""},on:{click:function(t){return t.stopPropagation(),e.notesBtn()}}}),t("span",[e._v("笔记")])]),t("div",{staticClass:"item-box"},[t("img",{attrs:{src:s(25078),alt:""},on:{click:function(t){return t.stopPropagation(),e.lineationBtn()}}}),t("span",[e._v("划线")])])])])}),h=[],c=(s(57658),s(55733),s(98610)),u=s(80119),g=s(66770),p={components:{noData:g["default"]},data(){return{showAddNotes:!1,topDistance:160,leftpDistance:200,searchList:[],loading:!1,goodsId:this.$route.query.goodsId,filesId:"",goodsFilePath:"",book:{},rendition:[],highlights:[],bookmarkList:[],note:{},displayed:{},bijivisible:!1,muluvisible:!1,searchVisible:!1,shezhivisible:!1,flag:!0,isRTL:!0,chapterName:"",readingLocation:"",readTime:"",progress:0,flow:"auto",mulu:void 0,num:16,locations:{},backclass:"zt_moren",backgroundList:[{backclass:"zt_moren",color:"#f8f4e9"},{backclass:"zt_niupizhi",color:"#dbcfa5"},{backclass:"zt_danlvse",color:"#ebf1e5"},{backclass:"zt_danlanse",color:"#e9f5f5"},{backclass:"zt_danfense",color:"#f4e9e9"},{backclass:"zt_huise",color:"#e6e2e2"},{backclass:"zt_heise",color:"#424242"}],sliderMax:100,sliderList:[],zwzt:"'Microsoft YaHei',PingFangSC-Regular,HelveticaNeue-Light,'Helvetica Neue Light',sans-serif",zwztList:[{value:"'Microsoft YaHei',PingFangSC-Regular,HelveticaNeue-Light,'Helvetica Neue Light',sans-serif",label:"雅黑"},{value:"STKaiti,Kaiti",label:"楷书"}],bookdetail:{},sourceList:[],readdefault:0,TimeParameter:10,readingTimeCount:0,setInterval2:void 0,setInterval1:void 0,isBookshelf:!1,cfiRange:"",Trial:!1,boxViewer:!0,searchInput:"",bookmarkVisible:!1,range:null,contents:null,currentCfi:""}},watch:{$route(){this.$route.query.goodsId}},created(){"true"==this.$route.query.isTrial?this.Trial=!0:this.Trial=!1},destroyed(){this.closeTime()},methods:{searchcfi(e){this.rendition.display(e.cfi),this.searchVisible=!1,this.searchInput="",this.searchList=[]},xdoSearch(e){return Promise.all(this.book.spine.spineItems.map((t=>t.load(this.book.load.bind(this.book)).then(t.find.bind(t,e)).finally(t.unload.bind(t))))).then((e=>Promise.resolve([].concat.apply([],e))))},xsearch(e){if(""==e)return this.$message("搜索内容不能为空");this.xdoSearch(e).then((t=>{let s=t.map((t=>(t.excerpt=t.excerpt.replace(e,`<span class="content-search-text" style="color: #2e9adb;\n             font-size: 13px;\n             font-family: PingFang SC;\n             font-weight: 400;">${e}</span>`),t)));this.searchList=s,console.log(this.searchList)}))},tabbook(e,t){if(this.Trial=!1,this.IsBookshelfAdd(),localStorage.getItem("shezhisave")){var s=JSON.parse(localStorage.getItem("shezhisave"));this.num=s.num,this.zwzt=s.zwzt,this.backclass=s.backclass,this.$store.state.read.backclass=s.backclass}(0,a.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((s=>{let i=s.data;i&&this.buys(e,t,i)}))},buys(e,t,s){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((i=>{s.hasPermission?(this.readdefault=t,this.boxViewer=!0,this.goodsFilePath=s.filePath,this.initbook(e,t,s.readingLocation),this.selectTimeParameter()):"1"==i.data&&"2"==e.sourceStatus?(this.Trial=!0,this.boxViewer=!0,this.goodsFilePath=s.filePath,this.initbook(e,t,s.readingLocation)):(this.goodsFilePath="",this.boxViewer=!1,this.checkIsBuys())}))},checkIsBuys(){let e="";e=0==this.Trial?"该文件需要购买后才能阅读，是否确认购买":"购买后可继续阅读",this.$alert(`${e}`,"购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})},IsBookshelfAdd(){(0,n.Qn)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{200==e.code&&(this.isBookshelf=e.data)}))},blurNumber(e,t){e.target.value||(this.num=12)},selectTimeParameter(){(0,a.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading(),this.updateOcReadSchedule()}),6e4*this.TimeParameter)}))},selectReadInfo(){(0,a.v6)({filesId:this.filesId}).then((e=>{null===e.data?this.readingTimeCount=0:this.readingTimeCount=60*e.data.readingTimeCount,this.setInterval1=setInterval((()=>{this.readingTimeCount++}),1e3)}))},closeTime(){clearInterval(this.setInterval1),clearInterval(this.setInterval2),this.setInterval1=null,this.setInterval2=null},updateOcDownloadReading(){(0,a.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},updateOcReadSchedule(){const e=this.progress/100,t=e>0?this.locations.cfiFromPercentage(e):0;(0,a.sS)({fileId:this.filesId,readingLocation:t}).then((e=>{}))},initbook(e,t,s){document.getElementById("viewer").remove();var i=document.createElement("div");i.id="viewer",i.className="scrolled",document.getElementById("box").appendChild(i),this.progress=0,this.readdefault=t,this.filesId=e.filesId,this.showEpub(s),this.initNoteList("note"),this.initNoteList("bookmark"),this.initNoteList("lineation"),this.selectReadInfo()},sliderFormat(e){return 0!=e&&(e=parseFloat(e).toFixed(0)+"%"),e},showEpub(e){const t=this.$loading({lock:!0,text:"Loading"});var s=this;let i=this.goodsFilePath.split(".epub")[0]+"/container.xml";this.book=new c.ZP(i),this.rendition=this.book.renderTo("viewer",{width:window.innerWidth-450,height:window.innerHeight-112,flow:this.flow}),e?this.rendition.display(e):this.rendition.display(),this.book.ready.then((()=>{document.getElementById("next");let e=function(e){37==(e.keyCode||e.which)&&("rtl"===s.book.package.metadata.direction?s.nextPage():s.prevPage()),38==(e.keyCode||e.which)&&("rtl"===s.book.package.metadata.direction?s.nextPage():s.prevPage()),39==(e.keyCode||e.which)&&("rtl"===s.book.package.metadata.direction?s.prevPage():s.nextPage()),40==(e.keyCode||e.which)&&("rtl"===s.book.package.metadata.direction?s.prevPage():s.nextPage())};s.rendition.on("keyup",e),document.addEventListener("keyup",e,!1)})),this.rendition.on("relocated",(function(e){s.currentCfi=e.start.cfi;var t="rtl"===s.book.package.metadata.direction?document.getElementById("prev"):document.getElementById("next"),i="rtl"===s.book.package.metadata.direction?document.getElementById("next"):document.getElementById("prev");e.atEnd?t.style.visibility="hidden":t.style.visibility="visible",e.atStart?i.style.visibility="hidden":i.style.visibility="visible"})),this.book.ready.then((()=>(this.navigation=s.book.navigation,s.book.locations.generate()))).then((()=>{this.locations=s.book.locations,this.bookAvailable=!0,setTimeout((()=>{this.rendition.hooks.content.register(((e,t)=>{e.document.addEventListener("contextmenu",(e=>(e.preventDefault(),!1)))}))}),2e3)})),this.book.loaded.navigation.then((function(e){e.length;s.sliderList=s.treeToArray(JSON.parse(JSON.stringify(e.toc))),s.mulu=e.toc,console.log(s.mulu),setTimeout((()=>{s.result(),t.close()}),1e3)})),this.rendition.on("selected",(e=>{this.cfiRange=e})),this.rendition.on("mousedown",(e=>{s.showAddNotes&&(s.showAddNotes=!1,s.cfiRange="",s.range=null),"IMG"===e.srcElement.tagName&&(0,u.Z)({images:[e.srcElement.src],closeable:!0})})),this.rendition.on("mouseup",((e,t)=>{setTimeout((()=>{""!==this.cfiRange&&(this.contents=t,this.book.getRange(this.cfiRange).then((e=>{s.isRTL=!1,this.range=e,this.range?s.showAddNotes=!0:t.window.getSelection().empty()}),500))}))}))},treeToArray(e,t=[]){return e.forEach((e=>{const{subitems:s}=e;if(s&&(delete e.subitems,s.length))return t.push(e),this.treeToArray(s,t);t.push(e)})),t},onProgressChange(e){let t=e;e>10&&this.Trial?(this.$message("该商品试读结束"),this.checkIsBuys(),t=10):t=e,this.progress=t;const s=t/100,i=s>0?this.locations.cfiFromPercentage(s):"";i?this.rendition.display(i):this.rendition.display()},result(){this.changezt({backclass:this.backclass}),this.numchange(),this.changezwzt(this.zwzt);var e="zt_heise"===this.backclass?"#ccc":"#000";this.rendition.themes.default({"::selection":{background:"rgba(255,255,0, 0.3)"},".epubjs-hl":{fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"},body:{background:"rgba(255,255,255, 0)"},body:{color:e},body:{"background-size":"100%"},body:{"background-image":"none","background-size":"100%","background-repeat":"no-repeat"},video:{"max-width":"90%"}})},clickmulu(e){let t=this;this.rendition.display(e.href).then((()=>{const e=t.rendition.currentLocation(),s=Math.floor(1e4*t.locations.percentageFromCfi(e.start.cfi).toFixed(5))/100;if(t.progress=s,t.progress>10&&this.Trial){t.progress=10,this.checkIsBuys();const e=t.locations.cfiFromPercentage(t.progress/100);e&&this.rendition.display(e)}})),t.result(),t.muluvisible=!1},highlightClick(e){let t=this;setTimeout((()=>{this.rendition.display(e).then((()=>{const e=t.rendition.currentLocation(),s=Math.floor(1e4*t.locations.percentageFromCfi(e.start.cfi).toFixed(5))/100;t.progress=s})),this.result(),this.bijivisible=!1,this.bookmarkVisible=!1}),500)},changezt(e){this.backclass=e.backclass,this.$store.state.read.backclass=e.backclass},numchange(){this.num<=12?this.num=12:this.num>=48&&(this.num=48),this.shezhisave(),this.rendition.themes.fontSize(this.num+"px"),this.initNoteList("note")},changezwzt(e){this.zwzt=e,this.rendition.themes.font(this.zwzt)},updateNote(e){this.isRTL=!1,this.note=this.highlights[e],this.$prompt("请输入笔记内容","提示",{inputValue:this.note.noteContent,inputType:"textarea",confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputValidator:e=>!e||/^\s+$/.test(e)?"请输入笔记内容":e.length>100?"不能超过100字":void 0}).then((({value:e})=>{this.note.noteContent=e,(0,a.Vx)(this.note).then((e=>{this.$message({type:"success",message:"操作成功"}),this.initNoteList("note"),this.bijivisible=!0,this.isRTL=!0}))})).catch((()=>{this.isRTL=!0}))},removeNote(e,t){this.$confirm("确认删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.rendition.annotations.remove(e,"highlight"),(0,a.T8)(this.highlights[t].id).then((e=>{this.initNoteList("note"),this.$message({type:"success",message:"删除成功"}),this.bijivisible=!0})),!1)))},shezhisave(){setTimeout((()=>{var e={num:this.num,backclass:this.backclass,zwzt:this.zwzt};localStorage.setItem("shezhisave",JSON.stringify(e))}),300)},prevPage(){let e=this;e.isRTL&&this.rendition.prev().then((()=>{const t=e.rendition.currentLocation(),s=Math.floor(1e4*e.locations.percentageFromCfi(t.start.cfi).toFixed(5))/100;e.progress=s}))},nextPage(){let e=this;const t=e.rendition.currentLocation();let s="";if(t&&(s=Math.floor(1e4*e.locations.percentageFromCfi(t.start.cfi).toFixed(5))/100,s>10&&this.Trial))return this.$message("该商品试读结束"),void this.checkIsBuys();e.isRTL&&this.rendition.next().then((()=>{e.progress=s}))},addBookshelf(){let e=this.$store.getters.userId;if(e)if(this.isBookshelf){if(0==this.$route.query.typeName)return;(0,n._r)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{e.data&&(this.isBookshelf=!1,this.$message({message:"移出书架",type:"success"}))}))}else(0,n.Uw)(this.$route.query.goodsId).then((e=>{2===e.data.status?(0,n.sz)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{200==e.code&&(this.$message({message:"加入书架成功",type:"success"}),this.isBookshelf=!0)})):this.$message("该商品已下架")}));else this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}})},changeflow(){"auto"===this.flow?this.flow="scrolled":this.flow="auto",setTimeout((()=>{this.book.rendition.flow(this.flow),this.result(),this.rendition.display(this.rendition.location.start.cfi)}),100)},initNoteList(e){(0,a.V$)(this.filesId,e).then((t=>{if("note"==e){this.highlights=t.data;for(let e of t.data)this.rendition.annotations.remove(e.textRange,"highlight"),this.rendition.annotations.highlight(e.textRange,{},(e=>{setTimeout((()=>{this.cfiRange="",this.showAddNotes=!1}),700)}))}else if("bookmark"==e)this.bookmarkList=t.data;else if("lineation"==e)for(let e of t.data)this.rendition.annotations.remove(e.textRange,"highlight"),this.rendition.annotations.highlight(e.textRange,{},(t=>{setTimeout((()=>{this.cfiRange="",this.showAddNotes=!1}),700),this.$confirm("是否删除该划线标记?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>(this.rendition.annotations.remove(e.textRange,"highlight"),(0,a.T8)(e.id).then((e=>{this.initNoteList("lineation"),this.$message({type:"success",message:"删除成功"})})),!1)))}),"",{stroke:"red","fill-opacity":0});this.loading=!1}))},getNoteList(e){(0,a.V$)(this.filesId,e).then((t=>{"note"==e?this.highlights=t.data:"bookmark"==e&&(this.bookmarkList=t.data),this.loading=!1}))},notesBtn(){this.range&&(this.note={goodsId:this.goodsId,goodsFileId:this.filesId,originalText:this.range.toString(),textRange:this.cfiRange,href:"#"+this.cfiRange,noteContent:"",type:"note"},this.$prompt("请输入笔记内容","提示",{inputType:"textarea",confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputValidator:e=>!e||/^\s+$/.test(e)?"请输入笔记内容":e.length>100?"不能超过100字":void 0}).then((({value:e})=>{this.note.noteContent=e;let t=this;(0,a.Nu)(t.note).then((e=>{t.$message({type:"success",message:"操作成功"}),t.initNoteList("note"),t.bijivisible=!0,t.isRTL=!0,this.cfiRange="",t.showAddNotes=!1,t.contents.window.getSelection().empty()}))})).catch((()=>{this.rendition.annotations.remove(this.cfiRange,"highlight"),this.cfiRange="",this.isRTL=!0,this.showAddNotes=!1,this.contents.window.getSelection().empty()})))},lineationBtn(){this.range&&(this.note={goodsId:this.goodsId,goodsFileId:this.filesId,originalText:this.range.toString(),textRange:this.cfiRange,href:"#"+this.cfiRange,noteContent:"",type:"lineation"},(0,a.Nu)(this.note).then((e=>{this.$message({type:"success",message:"操作成功"}),this.initNoteList("lineation"),this.isRTL=!0,this.cfiRange="",this.showAddNotes=!1,this.contents.window.getSelection().empty()})))},bookmarksBtn(e){if("add"===e){const e=this.rendition.currentLocation();this.note={goodsId:this.goodsId,goodsFileId:this.filesId,originalText:e.start.href,textRange:e.start.cfi,href:"#"+e.start.href,noteContent:e.start.href,type:"bookmark"},(0,a.Nu)(this.note).then((e=>{this.$message({type:"success",message:"已加入书签"}),this.initNoteList("bookmark")}))}else{const e=this.rendition.currentLocation();this.bookmarkList.map((t=>{t.noteContent==e.start.href&&this.deleteBookmark(t.id)}))}},deleteBookmark(e){(0,a.T8)(e).then((e=>{this.initNoteList("bookmark"),this.$message({type:"success",message:"已移除书签"})}))},getMuluValue(e){for(let t=0;t<this.mulu.length;t++){if(this.mulu[t].href==e)return this.mulu[t].label;if(this.mulu[t].subitems.length>0)for(let s=0;s<this.mulu[t].subitems.length;t++)if(this.mulu[t].subitems[s].href==e)return this.mulu[t].subitems[s].label}return e}}},m=p,y=s(1001),f=(0,y.Z)(m,d,h,!1,null,"08ef8eff",null),v=f.exports,I=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"read_center_box",attrs:{id:"read_center_box"}},[t("p",{staticClass:"dqyd"},[t("img",{attrs:{src:s(14842)}}),e._v(" 您已阅读"+e._s(e._f("stohms")(e.readingTimeCount)))]),t("div",{attrs:{id:"box"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.boxViewer,expression:"boxViewer"}],staticStyle:{padding:"20px","box-sizing":"border-box"},attrs:{id:"viewer"}},[e.wsitch?t("div",{staticClass:"flipbook"},e._l(e.PdfItems,(function(e){return t("div",[t("div",{staticClass:"gradient"}),t("img",{attrs:{src:"http://"+e}})])})),0):e._e()])])]),t("div",{staticClass:"read_right_box"},[t("div",{staticClass:"read_right_box1"},[t("el-popover",{attrs:{placement:"left",width:"350",trigger:"click"},model:{value:e.shezhivisible,callback:function(t){e.shezhivisible=t},expression:"shezhivisible"}},[t("div",{staticClass:"shezhi"},[t("i",{staticClass:"el-icon-error",on:{click:function(t){e.shezhivisible=!1}}}),t("li",[t("p",[e._v("阅读主题")]),t("div",{staticClass:"xz_box ydzt"},e._l(e.backgroundList,(function(s,i){return t("span",{key:i,class:s.backclass===e.backclass?"active":"",style:"background: "+s.color,on:{click:function(t){e.changezt(s),e.result(),e.shezhisave()}}})})),0)])]),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(40103)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(89001)}}):e._e(),t("p",[e._v("设置")])])]),t("li",{class:0==this.$route.query.typeName&&!0===e.isBookshelf?"cursorDefault":"",on:{click:function(t){return e.addBookshelf()}}},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(86224)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(84798)}}):e._e(),e.isBookshelf?t("p",[e._v("已加书架")]):e._e(),e.isBookshelf?e._e():t("p",[e._v("加入书架")])]),t("li",{on:{click:e.fullScreen}},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(89581)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(84798)}}):e._e(),t("p",[e._v("全屏阅读")])])],1),t("div",{staticClass:"read_right_box2"},[t("div",{attrs:{id:"prev"}},[t("img",{style:1===e.PdfIndex?"visibility:hidden":"",attrs:{src:s(90194)},on:{click:function(t){return e.previous()}}})]),t("div",{attrs:{id:"next"}},[t("img",{style:e.PdfIndex===e.PdfSize?"visibility:hidden":"",attrs:{src:s(5130)},on:{click:function(t){return e.next()}}})])])]),e.PdfSize>1?t("div",{staticClass:"slider_box"},[t("el-slider",{attrs:{min:1,max:e.PdfSize},on:{change:e.onProgressChange},model:{value:e.PdfIndex,callback:function(t){e.PdfIndex=t},expression:"PdfIndex"}})],1):e._e()])},b=[],k=(s(95715),s(55436),s(47489)),T=(s(61893),{components:{},data(){return{goodsId:this.$route.query.goodsId,filesId:"",goodsFilePath:"",backclass:"zt_moren",shezhivisible:!1,backgroundList:[{backclass:"zt_moren",color:"#f8f4e9"},{backclass:"zt_niupizhi",color:"#dbcfa5"},{backclass:"zt_danlvse",color:"#ebf1e5"},{backclass:"zt_danlanse",color:"#e9f5f5"},{backclass:"zt_danfense",color:"#f4e9e9"},{backclass:"zt_huise",color:"#e6e2e2"},{backclass:"zt_heise",color:"#424242"}],bookdetail:{},sourceList:[],readdefault:0,TimeParameter:10,readingTimeCount:0,setInterval2:void 0,setInterval1:void 0,PdfItems:[],PdfIndex:1,PdfSize:1,slider:"",loading:!1,item:void 0,index:void 0,wsitch:!0,isBookshelf:!1,TrialPdfSize:"",Trial:!1,boxViewer:!0}},created(){},destroyed(){this.closeTime()},methods:{tabbook(e,t){if(this.Trial=!1,this.IsBookshelfAdd(),this.item=e,this.index=t,this.loading=this.$loading({lock:!0}),localStorage.getItem("shezhisave")){var s=JSON.parse(localStorage.getItem("shezhisave"));this.num=s.num,this.zwzt=s.zwzt,this.backclass=s.backclass,this.$store.state.read.backclass=s.backclass}(0,a.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((s=>{let i=s.data;i&&this.buys(e,t,i)}))},buys(e,t,s){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((i=>{s.hasPermission?(this.readdefault=t,this.boxViewer=!0,this.goodsFilePath=s.filePath,this.initbook(e,t,s.readingLocation),this.selectTimeParameter()):"1"==i.data&&"2"==e.sourceStatus?(this.Trial=!0,this.boxViewer=!0,this.readdefault=t,this.goodsFilePath=s.filePath,this.initbook(e,t,s.readingLocation)):(this.goodsFilePath="",this.boxViewer=!1,this.checkIsBuys())}))},checkIsBuys(){let e="";e=0==this.Trial?"该文件需要购买后才能阅读，是否确认购买":"购买后可继续阅读",this.loading.close(),this.$alert(`${e}`,"购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})},IsBookshelfAdd(){(0,n.Qn)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{200==e.code&&(this.isBookshelf=e.data)}))},selectTimeParameter(){(0,a.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading(),this.updateOcReadSchedule()}),6e4*this.TimeParameter)}))},onProgressChange(e){if(Number(this.TrialPdfSize)<e&&this.Trial)return this.PdfIndex=Number(this.TrialPdfSize),this.$message("该商品试读结束"),void this.checkIsBuys();$(".flipbook").turn("page",this.PdfIndex)},selectReadInfo(){(0,a.v6)({filesId:this.filesId}).then((e=>{null===e.data?this.readingTimeCount=0:this.readingTimeCount=60*e.data.readingTimeCount,this.setInterval1=setInterval((()=>{this.readingTimeCount++}),1e3)}))},closeTime(){clearInterval(this.setInterval1),clearInterval(this.setInterval2),this.setInterval1=null,this.setInterval2=null},updateOcDownloadReading(){(0,a.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},updateOcReadSchedule(){(0,a.sS)({fileId:this.filesId,readingLocation:this.PdfIndex}).then((e=>{}))},initbook(e,t,s){this.readdefault=t,this.filesId=e.filesId,this.wsitch=!1,setTimeout((()=>{this.wsitch=!0,(0,a.Rd)({filePath:this.goodsFilePath}).then((e=>{if(this.PdfItems=e.data,this.PdfSize=e.data.length,this.Trial){let e=.1*this.PdfSize;this.TrialPdfSize=e.toFixed(),this.PdfSize<10&&(this.TrialPdfSize=1),this.PdfItems=this.PdfItems.slice(0,this.TrialPdfSize)}this.showEpub(s),this.selectReadInfo()}))}),100)},showEpub(e){var t=this;setTimeout((function(){setTimeout((function(){$(".flipbook").turn({width:window.innerWidth-522,height:window.innerHeight-130,elevation:50,autoCenter:!0,when:{turned:function(e,s){t.PdfIndex=s}}})}),300),e>1&&setTimeout((()=>{$(".flipbook").turn("page",e)}),600),setTimeout((()=>{document.getElementById("next");let e=function(e){return 37==(e.keyCode||e.which)&&$(".flipbook").turn("previous"),38==(e.keyCode||e.which)&&$(".flipbook").turn("previous"),39==(e.keyCode||e.which)&&($(".flipbook").turn("next"),Number(t.TrialPdfSize)==t.PdfIndex&&t.Trial)||40==(e.keyCode||e.which)&&($(".flipbook").turn("next"),Number(t.TrialPdfSize)==t.PdfIndex&&t.Trial)?(t.$message("该商品试读结束"),void this.checkIsBuys()):void 0};document.addEventListener("keyup",e,!1)}),800),t.loading.close()}),100)},addBookshelf(){let e=this.$store.getters.userId;if(e)if(this.isBookshelf){if(0==this.$route.query.typeName)return;(0,n._r)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{e.data&&(this.isBookshelf=!1,this.$message({message:"移出书架",type:"success"}))}))}else(0,n.Uw)(this.$route.query.goodsId).then((e=>{2===e.data.status?(0,n.sz)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{200==e.code&&(this.$message({message:"加入书架成功",type:"success"}),this.isBookshelf=!0)})):this.$message("该商品已下架")}));else this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}})},fullScreen(){this.loading=this.$loading({lock:!0}),k.Z.toggle(),this.wsitch=!1,setTimeout((()=>{this.wsitch=!0,setTimeout((()=>{this.tabbook(this.item,this.index)}),100)}),100)},previous(){$(".flipbook").turn("previous")},next(){if(Number(this.TrialPdfSize)==this.PdfIndex&&this.Trial)return this.$message("该商品试读结束"),void this.checkIsBuys();$(".flipbook").turn("next")},result(){this.changezt({backclass:this.backclass});this.backclass},changezt(e){this.backclass=e.backclass,this.$store.state.read.backclass=e.backclass},shezhisave(){setTimeout((()=>{var e={num:this.num,backclass:this.backclass,zwzt:this.zwzt};localStorage.setItem("shezhisave",JSON.stringify(e))}),300)}}}),_=T,x=(0,y.Z)(_,I,b,!1,null,"58285cc5",null),q=x.exports,P=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"read_center_box",attrs:{id:"read_center_box"}},[t("p",{staticClass:"dqyd"},[t("img",{attrs:{src:s(14842)}}),e._v(" 您已阅读"+e._s(e._f("stohms")(e.readingTimeCount)))]),t("div",{attrs:{id:"box"}},[t("div",{staticStyle:{padding:"20px","box-sizing":"border-box"},attrs:{id:"viewer"}},[t("iframe",{staticStyle:{width:"100%",height:"calc(100vh - 120px)"},attrs:{src:"https://view.officeapps.live.com/op/embed.aspx?src="+e.goodsFilePath}})])])]),t("div",{staticClass:"read_right_box"},[t("div",{staticClass:"read_right_box1"},[t("el-popover",{attrs:{placement:"left",width:"350",trigger:"click"},model:{value:e.shezhivisible,callback:function(t){e.shezhivisible=t},expression:"shezhivisible"}},[t("div",{staticClass:"shezhi"},[t("i",{staticClass:"el-icon-error",on:{click:function(t){e.shezhivisible=!1}}}),t("li",[t("p",[e._v("阅读主题")]),t("div",{staticClass:"xz_box ydzt"},e._l(e.backgroundList,(function(s,i){return t("span",{key:i,class:s.backclass===e.backclass?"active":"",style:"background: "+s.color,on:{click:function(t){e.changezt(s),e.result(),e.shezhisave()}}})})),0)])]),t("li",{attrs:{slot:"reference"},slot:"reference"},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(40103)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(89001)}}):e._e(),t("p",[e._v("设置")])])]),t("li",{class:0==this.$route.query.typeName&&!0===e.isBookshelf?"cursorDefault":"",on:{click:function(t){return e.addBookshelf()}}},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(86224)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(84798)}}):e._e(),e.isBookshelf?t("p",[e._v("已加书架")]):e._e(),e.isBookshelf?e._e():t("p",[e._v("加入书架")])]),t("li",{on:{click:e.fullScreen}},["zt_heise"!==e.backclass?t("img",{attrs:{src:s(89581)}}):e._e(),"zt_heise"===e.backclass?t("img",{attrs:{src:s(84798)}}):e._e(),t("p",[e._v("全屏阅读")])])],1)])])},C=[],w={components:{},data(){return{goodsId:this.$route.query.goodsId,filesId:"",goodsFilePath:"",backclass:"zt_moren",shezhivisible:!1,backgroundList:[{backclass:"zt_moren",color:"#f8f4e9"},{backclass:"zt_niupizhi",color:"#dbcfa5"},{backclass:"zt_danlvse",color:"#ebf1e5"},{backclass:"zt_danlanse",color:"#e9f5f5"},{backclass:"zt_danfense",color:"#f4e9e9"},{backclass:"zt_huise",color:"#e6e2e2"},{backclass:"zt_heise",color:"#424242"}],bookdetail:{},sourceList:[],readdefault:0,TimeParameter:10,readingTimeCount:0,setInterval2:void 0,setInterval1:void 0,loading:!1,item:void 0,index:void 0,wsitch:!0,isBookshelf:!1}},created(){},destroyed(){this.closeTime()},methods:{tabbook(e,t){if(this.IsBookshelfAdd(),this.item=e,this.index=t,this.loading=this.$loading({lock:!0}),localStorage.getItem("shezhisave")){var s=JSON.parse(localStorage.getItem("shezhisave"));this.num=s.num,this.zwzt=s.zwzt,this.backclass=s.backclass,this.$store.state.read.backclass=s.backclass}(0,a.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((s=>{this.loading.close();let i=s.data;i&&this.buys(e,t,i)}))},buys(e,t,s){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((i=>{s.hasPermission?(this.readdefault=t,this.goodsFilePath=s.filePath,this.initbook(e,t,s.readingLocation),this.selectTimeParameter()):"1"==i.data&&"2"==e.sourceStatus?(this.Trial=!0,this.readdefault=t,this.goodsFilePath=s.filePath,this.initbook(e,t,s.readingLocation)):(this.goodsFilePath="",this.checkIsBuys())}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})},IsBookshelfAdd(){(0,n.Qn)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{200==e.code&&(this.isBookshelf=e.data)}))},selectTimeParameter(){(0,a.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},selectReadInfo(){(0,a.v6)({filesId:this.filesId}).then((e=>{null===e.data?this.readingTimeCount=0:this.readingTimeCount=60*e.data.readingTimeCount,this.setInterval1=setInterval((()=>{this.readingTimeCount++}),1e3)}))},closeTime(){clearInterval(this.setInterval1),clearInterval(this.setInterval2),this.setInterval1=null,this.setInterval2=null},updateOcDownloadReading(){(0,a.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},initbook(e,t,s){this.readdefault=t,this.filesId=e.filesId,this.loading.close(),this.selectReadInfo()},addBookshelf(){let e=this.$store.getters.userId;if(e)if(this.isBookshelf){if(0==this.$route.query.typeName)return;(0,n._r)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{e.data&&(this.isBookshelf=!1,this.$message({message:"移出书架",type:"success"}))}))}else(0,n.Uw)(this.$route.query.goodsId).then((e=>{2===e.data.status?(0,n.sz)({goodsId:this.$route.query.goodsId,type:this.$route.query.resourceType}).then((e=>{200==e.code&&(this.$message({message:"加入书架成功",type:"success"}),this.isBookshelf=!0)})):this.$message("该商品已下架")}));else this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}})},treeToArray(e,t=[]){return e.forEach((e=>{const{subitems:s}=e;if(s&&(delete e.subitems,s.length))return t.push(e),this.treeToArray(s,t);t.push(e)})),t},fullScreen(){this.loading=this.$loading({lock:!0}),k.Z.toggle(),this.wsitch=!1,setTimeout((()=>{this.wsitch=!0,setTimeout((()=>{this.tabbook(this.item,this.index),this.loading.close()}),100)}),100)},result(){this.changezt({backclass:this.backclass});this.backclass},changezt(e){this.backclass=e.backclass,this.$store.state.read.backclass=e.backclass},shezhisave(){setTimeout((()=>{var e={num:this.num,backclass:this.backclass,zwzt:this.zwzt};localStorage.setItem("shezhisave",JSON.stringify(e))}),300)}}},z=w,N=(0,y.Z)(z,P,C,!1,null,"14183fda",null),R=N.exports,B=s(33969),S=s(42658),L=s(92190),F=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video_box_s"},[t("div",{staticClass:"video_box"},[t("div",{staticClass:"audiotitlex"},[e._m(0),t("div",{staticClass:"fileName_box"},[e._v(" "+e._s(e.fileName)+" ")])]),t("div",{staticClass:"_box"},[t("div",{staticClass:"image_box_row"},[t("img",{staticClass:"img_",attrs:{src:s(83105)}}),t("div",{staticClass:"text_"},[e._v(e._s(e.fileName))]),t("div",{staticClass:"text_"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.zipread}},[e._v("立即下载")])],1)])])])])},O=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"img_box"},[t("img",{staticClass:"img_box",attrs:{src:s(29861)}})])}],E=s(77997),A={data(){return{fileName:"",goodsId:this.$route.query.goodsId,filesId:"",goodsFilePath:"",bookdetail:{},sourceList:[],readdefault:0,item:void 0,index:void 0,srcList:[],ouchnoss1:null,loading:!1,setInterval2:void 0,TimeParameter:10}},created(){this.stopEvent(),this.ouchnoss1=new E.k(!0)},destroyed(){this.closeTime()},methods:{selectTimeParameter(){(0,a.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},closeTime(){clearInterval(this.setInterval2),this.setInterval2=null},updateOcDownloadReading(){(0,a.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},zipread(){""!=this.goodsFilePath&&this.ouchnoss1.downloadByUrl(this.goodsFilePath,this.fileName)},stopEvent(){document.oncontextmenu=function(e){return!1}},tabbook(e){this.fileName=e.sourceName,this.filesId=e.filesId,this.loading=this.$loading({lock:!0}),(0,a.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((t=>{this.loading.close();let s=t.data;s&&this.buys(e,s)}))},buys(e,t){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((s=>{t.hasPermission?(this.goodsFilePath=t.filePath,this.selectTimeParameter()):"1"==s.data&&"2"==e.sourceStatus?(this.Trial=!0,this.goodsFilePath=t.filePath):(this.goodsFilePath="",this.checkIsBuys())}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})}}},D=A,V=(0,y.Z)(D,F,O,!1,null,"0e34db61",null),M=V.exports,U=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"audio_box_s"},[t("div",[t("div",{staticClass:"audiotitlex"},[e._m(0),t("div",{staticClass:"fileName_box"},[e._v(" "+e._s(e.fileName)+" ")])])]),t("iframe",{staticClass:"iframe",attrs:{src:e.goodsFilePath,frameborder:"0",width:"99%"}})])])},Z=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"img_box"},[t("img",{staticClass:"img_box",attrs:{src:s(56799)}})])}],j=s(66028),J=s(86264),H=s(39570),G={components:{videoPlayer:J.videoPlayer,audioPlay:H.Z},data(){return{fileName:"",goodsFileId:void 0,goodsId:this.$route.query.goodsId,filesId:"",relevanceId:void 0,resource:void 0,resourceType:void 0,teachInstId:void 0,goodsFilePath:"",readdefault:0,loading:!1,play:!1,setInterval2:void 0,TimeParameter:10}},props:{},created(){},destroyed(){this.closeTime()},methods:{selectTimeParameter(){(0,a.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},closeTime(){clearInterval(this.setInterval2),this.setInterval2=null},updateOcDownloadReading(){(0,a.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},tabbook(e){this.loading=this.$loading({lock:!0}),this.goodsFileId=e.filesId,this.fileName=e.sourceName,this.filesId=e.filesId,(0,a.Bi)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((t=>{this.loading.close();let s=t.data;s&&this.buys(e,s)}))},buys(e,t){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((s=>{if(t.hasPermission){let e=t.filePath,s=j.fileURL+"/goods_file"+e.split("goods_file")[1].split(".")[0];this.goodsFilePath=s,this.selectTimeParameter()}else if("1"==s.data&&"2"==e.sourceStatus){this.Trial=!0,this.goodsFilePath=t.filePath;let e=j.fileURL+"/goods_file"+goodsFilePath.split("goods_file")[1].split(".")[0];this.goodsFilePath=e}else this.goodsFilePath="",this.checkIsBuys()}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})}}},X=G,K=(0,y.Z)(X,U,Z,!1,null,"0cff2b54",null),Q=K.exports,W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video_box_s"},[t("div",{staticClass:"video_box"},[t("div",{staticClass:"audiotitlex"},[e._m(0),t("div",{staticClass:"fileName_box"},[e._v(" "+e._s(e.fileName)+" ")])]),t("div",{staticClass:"video_con"},[t("iframe",{staticClass:"iframe",attrs:{src:e.src,frameborder:"0",id:"iframe"}})])])])},Y=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"img_box"},[t("img",{staticClass:"img_box",attrs:{src:s(29861)}})])}],ee=s(28267),te=s(63683),se={data(){return{src:"",fileName:"",goodsId:this.$route.query.goodsId,filesId:"",bookdetail:{},sourceList:[],readdefault:0,item:void 0,index:void 0,srcList:[],loading:!1,setInterval2:void 0,TimeParameter:10}},created(){},destroyed(){this.closeTime()},methods:{looseleaf(e){(0,te.BF)().then((t=>{let s={token:t.data,pageType:"pc",businessType:e.type,looseLeafId:"",textBookId:"",isTrial:this.$route.query.isTrial||!1};"looseLeaf"==e.type?s.looseLeafId=e.filesId:s.textBookId=e.filesId,(0,ee.vG)(s).then((e=>{200==e.code&&(this.src=e.data)}))}))},selectTimeParameter(){(0,a.Nl)().then((e=>{this.TimeParameter=e.data,this.setInterval2=setInterval((()=>{this.updateOcDownloadReading()}),6e4*this.TimeParameter)}))},closeTime(){clearInterval(this.setInterval2),this.setInterval2=null},updateOcDownloadReading(){(0,a.IM)({goodsFileId:this.filesId,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((e=>{}))},tabbook(e){this.fileName=e.sourceName,this.filesId=e.filesId,this.loading=this.$loading({lock:!0}),(0,n.Mt)({goodsFileId:e.filesId,fileType:e.fileType,goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType,teachInstId:this.$route.query.teachInstId}).then((t=>{this.loading.close();let s=t.data;s&&this.buys(e,s)}))},buys(e,t){this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((s=>{t.hasPermission?(this.looseleaf(e),this.selectTimeParameter()):"1"==s.data&&"2"==e.sourceStatus?(this.Trial=!0,this.looseleaf(e)):this.checkIsBuys()}))},checkIsBuys(){this.$alert("该文件需要购买后才能阅读，是否确认购买","购买",{confirmButtonText:"立即购买",callback:e=>{if("cancel"===e)return;let t=this.$store.getters.userId;t?(this.payType=this.$route.query.payType?this.$route.query.payType:"goods",(0,n.kx)({relevanceId:this.goodsId,type:this.payType}).then((e=>{console.log("是否已购买响应",e),"2"!==e.data?"1"===e.data?this.$router.push({path:"/submitOrder/index",query:{id:this.$route.query.goodsId,from:"bookstore"}}):this.$message("该商品已购买无需重复购买"):this.$message.error("数据异常")}))):(this.$store.commit("SET_REDIRECTPARAMS",{goodsId:this.$route.query.goodsId,relevanceId:this.$route.query.relevanceId,resource:this.$route.query.resource,resourceType:this.$route.query.resourceType}),this.$router.push({path:"/login",query:{redirectPath:"/onlineReading"}}))}})}}},ie=se,oe=(0,y.Z)(ie,W,Y,!1,null,"3de6bfbc",null),re=oe.exports,ae={components:{epubread:v,pdfread:q,pweread:R,audioread:B["default"],imgread:S["default"],videoread:L["default"],zipread:M,htmlread:Q,leaflet:re,integralBox:r.Z},computed:{...(0,l.Se)(["backclass"])},data(){return{goodsFilePath:"",bookdetail:{},sourceList:[],readdefault:0,readtype:"",coverFiles:[],goodsTypeList:[],ouchnoss1:null,first:!0,goods_index:"",goodsTypes:"",isTrial:!1}},watch:{$route(){}},created(){this.readdefault=this.$route.query.readdefault||0,this.isTrial=this.$route.query.isTrial||!1,this.goodsInfoDetail(),(0,n.KR)("oc_resource_file").then((e=>{this.goodsTypeList=e.data}))},methods:{goodsInfoDetail(){(0,n.nC)(this.$route.query.goodsId).then((e=>{this.bookdetail=e.data.goods,this.sourceList=e.data.sourceList,this.coverFiles=e.data.coverFiles,this.coverFiles.length>0&&(this.cover_fullUrl=this.coverFiles[0].fullUrl),this.goodsTypes=e.data.goods.goodsType,this.tabbook(e.data.sourceList[this.readdefault],this.readdefault)}))},tabbook(e,t){if(this.$refs.integralBox.isAddIntegral(),this.first)this.readdefault=t,this.first=!1;else{if(t===this.readdefault)return;this.readdefault=t}e.fileName?"PUB"===e.fileName.substring(e.fileName.length-3).toUpperCase()?"EPUB"===e.fileName.substring(e.fileName.length-4).toUpperCase()?(this.readtype="epub",setTimeout((()=>{this.$refs.epubread.tabbook(e,t,this)}),200)):this.$alert("资源升级中，暂不支持阅读此文件","提示",{confirmButtonText:"确定",callback:e=>{}}):"PDF"===e.fileName.substring(e.fileName.length-3).toUpperCase()?(this.readtype="pdf",setTimeout((()=>{this.$refs.pdfread.tabbook(e,t,this)}),200)):"PPT"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"PTX"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"OCX"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"DOC"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"XLS"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"LSX"===e.fileName.substring(e.fileName.length-3).toUpperCase()?(this.readtype="pwe",setTimeout((()=>{this.$refs.pweread.tabbook(e,t,this)}),200)):"MP4"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"WMV"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"AVI"===e.fileName.substring(e.fileName.length-3).toUpperCase()?(this.readtype="videoread",setTimeout((()=>{this.$refs.videoread.tabbook(e,t,this)}),200)):"MP3"===e.fileName.substring(e.fileName.length-3).toUpperCase()?(this.readtype="audioread",setTimeout((()=>{this.$refs.audioread.tabbook(e,t,this)}),200)):"JPG"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"PNG"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"GIF"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"BPM"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"JPEG"===e.fileName.substring(e.fileName.length-4).toUpperCase()?(this.readtype="img",setTimeout((()=>{this.$refs.imgread.tabbook(e,t,this)}),200)):"ZIP"===e.fileName.substring(e.fileName.length-3).toUpperCase()||"RAR"===e.fileName.substring(e.fileName.length-3).toUpperCase()?"html"===this.bookdetail.resourceType&&"ZIP"===e.fileName.substring(e.fileName.length-3).toUpperCase()?(this.readtype="htmlread",setTimeout((()=>{this.$refs.htmlread.tabbook(e,t,this)}),200)):(this.readtype="zipread",setTimeout((()=>{this.$refs.zipread.tabbook(e,t,this)}),200)):"looseleafOrtextbook"==this.goodsTypes&&("looseLeaf"!=e.type&&"textBook"!=e.type||(this.readtype="leafletread",this.isTrial?this.$refs.leafletread.looseleaf(e,t):setTimeout((()=>{this.$refs.leafletread.tabbook(e,t)}),200))):"looseleafOrtextbook"==this.goodsTypes&&("looseLeaf"!=e.type&&"textBook"!=e.type||(this.readtype="leafletread",this.isTrial?setTimeout((()=>{this.$refs.leafletread.looseleaf(e,t)}),200):setTimeout((()=>{this.$refs.leafletread.tabbook(e,t)}),200)))}}},le=ae,ne=(0,y.Z)(le,i,o,!1,null,"0ca46b17",null),de=ne.exports},57976:function(e,t,s){s.d(t,{Bl:function(){return y},Gn:function(){return m},HM:function(){return v},d5:function(){return I},eA:function(){return T},jH:function(){return b},jh:function(){return f},kx:function(){return p},y:function(){return k}});var i=s(84471),o=s(37182);const r=o.V+"/web/api/ocOrder/orderList",a=o.V+"/web/api/ocOrder/addOcOrder",l=o.V+"/web/api/ocOrder/addOcOrderSubject",n=(o.V,o.V+"/web/api/ocOrder/deleteById"),d=o.V+"/web/api/ocOrder/orderCountByStatus",h=o.V+"/web/api/ocOrder/updateOrderStatus",c=o.V+"/web/api/ocOrder/addOrderInMyResource",u=(o.V,o.V+"/web/IntegralRecord/list"),g=o.V+"/web/IntegralRecord/count",p=e=>(0,i.U2)(r,e),m=e=>(0,i.v_)(a,e),y=e=>(0,i.v_)(l,e),f=e=>(0,i.v_)(`${h}?id=${e.id}`),v=e=>(0,i.v_)(`${c}?id=${e.id}`),I=e=>(0,i.U2)(d,e),b=e=>(0,i.ZP)({url:n,method:"delete",params:e}),k=e=>(0,i.ZP)({url:u,method:"get",params:e}),T=e=>(0,i.ZP)({url:g,method:"get",params:e})}}]);
//# sourceMappingURL=8360.1180542d.js.map