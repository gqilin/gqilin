{"version":3,"file":"js/3816.bc216c44.js","mappings":"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","sources":["webpack://vue3_test/./src/views/onlineReading/textBookReader.vue","webpack://vue3_test/src/views/onlineReading/textBookReader.vue","webpack://vue3_test/./src/views/onlineReading/textBookReader.vue?0b8f","webpack://vue3_test/./src/views/onlineReading/textBookReader.vue?4d3f","webpack://vue3_test/./src/utils/leafletRequest.js","webpack://vue3_test/./src/api/looseleaf/looseleaf.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[(_vm.digitalTeaching)?_c('xml-digital-teaching',{ref:\"xmlDigitalTeaching\",attrs:{\"textBookData\":_vm.textBookData,\"catalogList\":_vm.catalogList,\"looseLeafData\":_vm.looseLeafData,\"location\":_vm.location,\"notesList\":_vm.notesList,\"bookmarkList\":_vm.bookmarkList,\"textDomList\":_vm.contentList,\"continueReading\":true,\"isTrial\":_vm.isTrial,\"isTrialIndex\":_vm.isTrialIndex,\"basisPath\":_vm.basisPath,\"pageType\":_vm.pageType,\"trialText\":_vm.trialText,\"trialPrompt\":_vm.trialPrompt,\"officePreviewPath\":\"https://idocview.cmpjjj.com/view/url?url=\"},on:{\"updateReadLocation\":_vm.updateReadLocation,\"confirm\":_vm.confirm,\"updateNotes\":_vm.updateNotes,\"deleteNotes\":_vm.deleteNotes,\"addBookmark\":_vm.addBookmark,\"deleteBookmark\":_vm.deleteBookmark,\"downloadFile\":_vm.downloadFile,\"addTextDom\":_vm.addTextDom,\"updateTextDom\":_vm.updateTextDom,\"deleteTextDom\":_vm.deleteTextDom}}):_vm._e()],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <xml-digital-teaching\r\n      v-if=\"digitalTeaching\"\r\n      ref=\"xmlDigitalTeaching\"\r\n      :textBookData=\"textBookData\"\r\n      :catalogList=\"catalogList\"\r\n      :looseLeafData=\"looseLeafData\"\r\n      :location=\"location\"\r\n      :notesList=\"notesList\"\r\n      :bookmarkList=\"bookmarkList\"\r\n      :textDomList=\"contentList\"\r\n      :continueReading=\"true\"\r\n      :isTrial=\"isTrial\"\r\n      :isTrialIndex=\"isTrialIndex\"\r\n      @updateReadLocation=\"updateReadLocation\"\r\n      @confirm=\"confirm\"\r\n      @updateNotes=\"updateNotes\"\r\n      @deleteNotes=\"deleteNotes\"\r\n      @addBookmark=\"addBookmark\"\r\n      @deleteBookmark=\"deleteBookmark\"\r\n      @downloadFile=\"downloadFile\"\r\n      @addTextDom=\"addTextDom\"\r\n      @updateTextDom=\"updateTextDom\"\r\n      @deleteTextDom=\"deleteTextDom\"\r\n      :basisPath=\"basisPath\"\r\n      :pageType=\"pageType\"\r\n      :trialText=\"trialText\"\r\n      :trialPrompt=\"trialPrompt\"\r\n      officePreviewPath=\"https://idocview.cmpjjj.com/view/url?url=\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getTextBookInfo,\r\n  getTextBookCatalog,\r\n  getTextBookLooseLeaf,\r\n} from \"@/api/looseleaf/looseleaf\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      digitalTeaching: false,\r\n      textBookData: {},\r\n      catalogList: [],\r\n      looseLeafData: {},\r\n      trialText: \"<p>该处已超出试读范围</p><p>请购买后阅读</p>\",\r\n      trialPrompt: \"<p>该处已超出试读范围</p><p>请购买后阅读</p>\",\r\n      location: \"\",\r\n      basisPath: \"\",\r\n      notesList: [],\r\n      bookmarkList: [],\r\n      pageType: \"pc\",\r\n      contentList: [],\r\n      isTrial: false,\r\n      isTrialIndex: 10,\r\n      textBookId: \"1660446560604454912\",\r\n      isShow: \"\",\r\n    };\r\n  },\r\n  created() {\r\n    let router = this.$route.query;\r\n    if (router.textBookId) {\r\n      this.textBookId = router.textBookId;\r\n    }\r\n    if (router.pageType) {\r\n      this.pageType = router.pageType;\r\n    }\r\n\r\n    getTextBookInfo(this.textBookId).then((res) => {\r\n      this.textBookData = res.data;\r\n    });\r\n    getTextBookCatalog(this.textBookId, \"0\").then((res) => {\r\n      this.catalogList = res.data;\r\n    });\r\n    getTextBookLooseLeaf(this.textBookId).then((res) => {\r\n      this.looseLeafData = JSON.parse(res.msg);\r\n      setTimeout(() => {\r\n        this.digitalTeaching = true;\r\n      }, 500);\r\n    });\r\n\r\n    this.location = localStorage.getItem(this.textBookData.id);\r\n    this.notesList = JSON.parse(localStorage.getItem(\"notesList\")) || [];\r\n    this.bookmarkList = JSON.parse(localStorage.getItem(\"bookmarkList\")) || [];\r\n    this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n    this.location = localStorage.getItem(this.textBookId);\r\n  },\r\n\r\n  methods: {\r\n    // 确认添加笔记\r\n    confirm(e) {\r\n      this.notesList.push(e);\r\n      let list = JSON.stringify(this.notesList);\r\n      localStorage.setItem(\"notesList\", list);\r\n      this.notesList = JSON.parse(localStorage.getItem(\"notesList\")) || [];\r\n      // 添加笔记成功后显示笔记标记\r\n      this.$refs.xmlDigitalTeaching.addNotesSign(e.location, \"notes\");\r\n    },\r\n\r\n    // 更新笔记\r\n    updateNotes(e) {\r\n      this.notesList.map((item, index) => {\r\n        if (item.notesId === e.notesId) {\r\n          this.notesList[index].notesContent = item.notesContent;\r\n          localStorage.setItem(\"notesList\", JSON.stringify(this.notesList));\r\n          this.notesList = JSON.parse(localStorage.getItem(\"notesList\")) || [];\r\n        }\r\n      });\r\n    },\r\n\r\n    // 删除笔记\r\n    deleteNotes(e) {\r\n      this.notesList.map((item, index) => {\r\n        if (item.notesId === e.notesId) {\r\n          this.notesList.splice(index, 1);\r\n          localStorage.setItem(\"notesList\", JSON.stringify(this.notesList));\r\n          this.notesList = JSON.parse(localStorage.getItem(\"notesList\")) || [];\r\n          // 删除笔记成功后删除笔记标记\r\n          this.$refs.xmlDigitalTeaching.deleteNotesSign(e.location, \"notes\");\r\n        }\r\n      });\r\n    },\r\n\r\n    addTextDom(e) {\r\n      this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n      // const index = this.contentList.findIndex((item) => item.domId == e.location)\r\n      // if (index == -1) {\r\n      this.contentList.push({\r\n        id: e.id,\r\n        contentDom: e.contentDom,\r\n        domId: e.domId,\r\n      });\r\n      // } else {\r\n      // this.contentList[index].contentDom = e.contentDom\r\n      // }\r\n      let list2 = JSON.stringify(this.contentList);\r\n      localStorage.setItem(\"contentList\", list2);\r\n      this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n    },\r\n    updateTextDom(e) {\r\n      this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n      const index = this.contentList.findIndex((item) => item.domId == e.domId);\r\n      this.contentList[index].contentDom = e.contentDom;\r\n      let list2 = JSON.stringify(this.contentList);\r\n      localStorage.setItem(\"contentList\", list2);\r\n      this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n    },\r\n    deleteTextDom(e) {\r\n      this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n      const index = this.contentList.findIndex((item) => item.domId == e.domId);\r\n      this.contentList.splice(index, 1);\r\n\r\n      let list2 = JSON.stringify(this.contentList);\r\n      localStorage.setItem(\"contentList\", list2);\r\n      this.contentList = JSON.parse(localStorage.getItem(\"contentList\")) || [];\r\n    },\r\n\r\n    // 添加书签\r\n    addBookmark(e) {\r\n      this.bookmarkList.push(e);\r\n      let list = JSON.stringify(this.bookmarkList);\r\n      localStorage.setItem(\"bookmarkList\", list);\r\n      this.bookmarkList =\r\n        JSON.parse(localStorage.getItem(\"bookmarkList\")) || [];\r\n      // 添加书签成功后显示书签标记\r\n      this.$refs.xmlDigitalTeaching.addNotesSign(e.location, \"bookmark\");\r\n    },\r\n\r\n    // 删除书签\r\n    deleteBookmark(e) {\r\n      this.bookmarkList.map((item, index) => {\r\n        if (item.bookmarkId === e.bookmarkId) {\r\n          this.bookmarkList.splice(index, 1);\r\n          localStorage.setItem(\r\n            \"bookmarkList\",\r\n            JSON.stringify(this.bookmarkList)\r\n          );\r\n          this.bookmarkList =\r\n            JSON.parse(localStorage.getItem(\"bookmarkList\")) || [];\r\n          // 删除书签成功后删除书签标记\r\n          this.$refs.xmlDigitalTeaching.deleteNotesSign(e.location, \"bookmark\");\r\n        }\r\n      });\r\n    },\r\n\r\n    // 下载资源文件\r\n    downloadFile(e) {},\r\n\r\n    // 更新阅读进度\r\n    updateReadLocation(newLocation) {\r\n      localStorage.setItem(this.textBookData.id, newLocation);\r\n    },\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./textBookReader.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./textBookReader.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./textBookReader.vue?vue&type=template&id=b73f4482&\"\nimport script from \"./textBookReader.vue?vue&type=script&lang=js&\"\nexport * from \"./textBookReader.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import axios from \"axios\";\r\nimport { Notification, MessageBox, Message, Loading } from \"element-ui\";\r\nimport store from \"@/store\";\r\nimport { getToken, platform } from \"@/utils/auth\";\r\nimport { tansParams, blobValidate } from \"@/utils/ruoyi\";\r\nimport cache from \"./cache\";\r\nimport { leafletApiURL, leafletSysId } from \"./config\";\r\nimport { post, asyncPost, get, asyncGet } from \"@/utils/requestDecorators\";\r\nimport Cookies from \"js-cookie\";\r\n\r\nexport const errorCode = {\r\n  \"401\": \"认证失败，无法访问系统资源\",\r\n  \"403\": \"当前操作没有权限\",\r\n  \"404\": \"访问资源不存在\",\r\n  default: \"系统未知错误，请反馈给管理员\"\r\n};\r\nlet loadingInstance = null;\r\nlet loadingState = false;\r\nlet loadingTimer = null;\r\n// 是否显示重新登录\r\nexport let isRelogin = { show: false };\r\n\r\naxios.defaults.headers[\"Content-Type\"] = \"application/json;charset=utf-8\";\r\n\r\n//创建axios实例\r\nconst service = axios.create({\r\n  baseURL: leafletApiURL, // api的base_url\r\n  timeout: 100000 // 请求超时设置\r\n});\r\n\r\n// 请求拦截\r\nservice.interceptors.request.use(\r\n  config => {\r\n    // 是否需要设置 token\r\n    const isToken = (config.headers || {}).isToken === false;\r\n    // 是否需要防止数据重复提交\r\n    const isRepeatSubmit = (config.headers || {}).repeatSubmit === false;\r\n    if (getToken() && !isToken) {\r\n      config.headers[\"Authorization\"] = \"Bearer \" + getToken(); // 让每个请求携带自定义token 请根据实际情况自行修改\r\n    }\r\n\r\n    // if (config.header) {//移动端阅读webview传递token的骚操作\r\n    //   if (config.header.token) {//移动端阅读webview传递token的骚操作\r\n    //     config.headers['Authorization'] = 'Bearer ' + localStorage.getItem('token')\r\n    //   }\r\n    // }\r\n    // let token = JSON.stringify(config.data.token);\r\n    //平台代号\r\n    // config.headers['platform'] = 'out'\r\n    // config.headers['sysId'] = leafletSysId\r\n    // config.headers['token'] = token\r\n    // get请求映射params参数\r\n    if (config.method === \"get\" && config.params) {\r\n      let url = config.url + \"?\" + tansParams(config.params);\r\n      url = url.slice(0, -1);\r\n      config.params = {};\r\n      config.url = url;\r\n    }\r\n\r\n    if (\r\n      !isRepeatSubmit &&\r\n      (config.method === \"post\" || config.method === \"put\")\r\n    ) {\r\n      const requestObj = {\r\n        url: config.url,\r\n        data:\r\n          typeof config.data === \"object\"\r\n            ? JSON.stringify(config.data)\r\n            : config.data,\r\n        time: new Date().getTime()\r\n      };\r\n      const sessionObj = cache.session.getJSON(\"sessionObj\");\r\n      if (\r\n        sessionObj === undefined ||\r\n        sessionObj === null ||\r\n        sessionObj === \"\"\r\n      ) {\r\n        cache.session.setJSON(\"sessionObj\", requestObj);\r\n      } else {\r\n        const s_url = sessionObj.url; // 请求地址\r\n        const s_data = sessionObj.data; // 请求数据\r\n        const s_time = sessionObj.time; // 请求时间\r\n        const interval = 2000; // 间隔时间(ms)，小于此时间视为重复提交\r\n        // 如果不是无需显示loading的接口\r\n        if (!apiList.includes(sessionObj.url)) {\r\n          // 请求1500毫秒后没有响应显示loading\r\n          // loadingTimer = setTimeout(() => {\r\n          //   if (!loadingState) {\r\n          //     loadingState = true\r\n          //     loadingInstance = Loading.service({ fullscreen: true });\r\n          //   }\r\n          // }, 1500)\r\n        }\r\n        if (\r\n          s_data === requestObj.data &&\r\n          requestObj.time - s_time < interval &&\r\n          s_url === requestObj.url\r\n        ) {\r\n          const message = \"数据正在处理，请勿重复提交\";\r\n          console.warn(`[${s_url}]: ` + message);\r\n          return Promise.reject(new Error(message));\r\n        } else {\r\n          cache.session.setJSON(\"sessionObj\", requestObj);\r\n        }\r\n      }\r\n    }\r\n    return config;\r\n  },\r\n  error => {\r\n    console.log(error);\r\n    Promise.reject(error);\r\n  }\r\n);\r\n\r\n// 响应拦截器\r\nservice.interceptors.response.use(\r\n  res => {\r\n    // 响应成功关闭loading\r\n    clearTimeout(loadingTimer);\r\n    if (loadingState) {\r\n      loadingState = false;\r\n      loadingInstance.close();\r\n    }\r\n    // 未设置状态码则默认成功状态\r\n    // console.log(res);\r\n    const config = res.config || {};\r\n    const code = res.data.code || 200;\r\n    // 获取错误信息\r\n    const msg = errorCode[code] || res.data.msg || errorCode[\"default\"];\r\n    // 二进制数据则直接返回\r\n    if (\r\n      res.request.responseType === \"blob\" ||\r\n      res.request.responseType === \"arraybuffer\"\r\n    ) {\r\n      return res.data;\r\n    }\r\n    if (code === 401) {\r\n      // if (!isRelogin.show) {\r\n      //   isRelogin.show = true\r\n      //   MessageBox.confirm('登录状态已过期，您可以继续留在该页面，或者重新登录', '系统提示', {\r\n      //     confirmButtonText: '重新登录',\r\n      //     cancelButtonText: '取消',\r\n      //     type: 'warning',\r\n      //   })\r\n      //     .then(() => {\r\n      //       isRelogin.show = false\r\n      //       if (store.getters.userId) {\r\n      //         store.dispatch('FedLogOut').then(() => {\r\n      //           location.href = '/#/login'\r\n      //         })\r\n      //       } else {\r\n      //         location.href = '/#/login'\r\n      //       }\r\n      //     })\r\n      //     .catch(() => {\r\n      //       isRelogin.show = false\r\n      //     })\r\n      // }\r\n      store.dispatch(\"FedLogOut\");\r\n      return Promise.reject(\"无效的会话，或者会话已过期，请重新登录。\");\r\n    } else if (\r\n      code === 500 &&\r\n      !apiList.includes(res.config.url.split(\"?\")[0])\r\n    ) {\r\n      console.log(123, apiList.includes(res.config.url));\r\n      console.log(1234, res.config.url.split(\"?\")[0]);\r\n      let showMsg = true;\r\n      if (config.isSilence || config.isFocusPassCode) {\r\n        showMsg = false;\r\n      }\r\n      showMsg &&\r\n        Message({\r\n          message: msg,\r\n          type: \"error\"\r\n        });\r\n      return config.isFocusPassCode ? res.data : Promise.reject(new Error(msg));\r\n    } else if (code !== 200) {\r\n      // Notification.error({\r\n      //   title: msg,\r\n      // })\r\n      if (!apiList.includes(res.config.url.split(\"?\")[0])) {\r\n        Message({\r\n          message: msg,\r\n          type: \"error\"\r\n        });\r\n      }\r\n      // return Promise.reject('error')\r\n      return Promise.reject(res.data); //hjx9.27\r\n    } else {\r\n      return res.data;\r\n    }\r\n  },\r\n  error => {\r\n    // 响应失败关闭loading\r\n    clearTimeout(loadingTimer);\r\n    if (loadingState) {\r\n      loadingState = false;\r\n      loadingInstance.close();\r\n    }\r\n    console.log(\"err: \" + error);\r\n    let { message } = error;\r\n    if (message == \"Network Error\") {\r\n      message = \"后端接口连接异常\";\r\n    } else if (message.includes(\"timeout\")) {\r\n      message = \"系统接口请求超时\";\r\n    } else if (message.includes(\"Request failed with status code\")) {\r\n      message = \"系统接口\" + message.substr(message.length - 3) + \"异常\";\r\n    }\r\n    if (message !== \"数据正在处理，请勿重复提交\") {\r\n      Message({\r\n        message: message,\r\n        type: \"error\",\r\n        duration: 5 * 1000\r\n      });\r\n    }\r\n    return Promise.reject(error);\r\n  },\r\n  () => {}\r\n);\r\n\r\nconst apiList = [\r\n  //不需要显示loading的接口\r\n  \"/ouchn-customapi/web/read/updateOcDownloadReading\",\r\n  \"/ouchn-customapi/getImagePathList?filePath=\",\r\n  \"/ouchn-customapi/web/tbOrderAuthCard/selectCardBuCardNo\"\r\n];\r\n\r\nexport default service;\r\nexport { post, asyncPost, get, asyncGet };\r\n","import request from \"@/utils/leafletRequest\";\r\n//获取活页式教材系统token\r\nexport function createPreviewSrc(data) {\r\n  return request({\r\n    url:\r\n      \"/textBook/createPreviewSrc?businessType=\" +\r\n      data.businessType +\r\n      \"&looseLeafId=\" +\r\n      data.looseLeafId +\r\n      \"&pageType=\" +\r\n      data.pageType +\r\n      \"&textBookId=\" +\r\n      data.textBookId +\r\n      \"&tyleType=B\" +\r\n      \"&isTrial=\" +\r\n      data.isTrial,\r\n    method: \"POST\",\r\n    data: data\r\n  });\r\n}\r\n//查询教材详细信息\r\nexport function getTextBookInfo(textBookId) {\r\n  return request({\r\n    url: \"/business/textBooks/getById?id=\" + textBookId,\r\n    method: \"GET\"\r\n  });\r\n}\r\n//查询教材目录列表\r\nexport function getTextBookCatalog(textBookId, hiddenFlag) {\r\n  return request({\r\n    url:\r\n      \"/business/catalog/list?textBookId=\" +\r\n      textBookId +\r\n      \"&hiddenFlag=\" +\r\n      hiddenFlag,\r\n    method: \"GET\"\r\n  });\r\n}\r\n//查询教材中的活页信息\r\nexport function getTextBookLooseLeaf(textBookId) {\r\n  return request({\r\n    url: \"/business/textBooks/getTextBookLooseLeaf?textBookId=\" + textBookId,\r\n    method: \"GET\"\r\n  });\r\n}\r\n"],"names":["render","_vm","this","_c","_self","digitalTeaching","ref","attrs","textBookData","catalogList","looseLeafData","location","notesList","bookmarkList","contentList","isTrial","isTrialIndex","basisPath","pageType","trialText","trialPrompt","on","updateReadLocation","confirm","updateNotes","deleteNotes","addBookmark","deleteBookmark","downloadFile","addTextDom","updateTextDom","deleteTextDom","_e","staticRenderFns","data","textBookId","isShow","created","router","$route","query","getTextBookInfo","then","res","getTextBookCatalog","getTextBookLooseLeaf","JSON","parse","msg","setTimeout","localStorage","getItem","id","methods","e","push","list","stringify","setItem","$refs","xmlDigitalTeaching","addNotesSign","map","item","index","notesId","notesContent","splice","deleteNotesSign","contentDom","domId","list2","findIndex","bookmarkId","newLocation","component","errorCode","default","loadingInstance","loadingState","loadingTimer","axios","defaults","headers","service","create","baseURL","leafletApiURL","timeout","interceptors","request","use","config","isToken","isRepeatSubmit","repeatSubmit","getToken","method","params","url","tansParams","slice","requestObj","time","Date","getTime","sessionObj","cache","session","getJSON","undefined","setJSON","s_url","s_data","s_time","interval","apiList","includes","message","console","warn","Promise","reject","Error","error","log","response","clearTimeout","close","code","responseType","store","dispatch","split","Message","type","showMsg","isSilence","isFocusPassCode","substr","length","duration","createPreviewSrc","businessType","looseLeafId","hiddenFlag"],"sourceRoot":""}