"use strict";(self["webpackChunkvue3_test"]=self["webpackChunkvue3_test"]||[]).push([[2763],{62763:function(e,t,r){r.r(t),r.d(t,{default:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("section",{staticClass:"page orderAppraise"},[t("div",{staticClass:"list-wrap"},e._l(e.goodsList,(function(a,s){return t("div",{key:s,staticClass:"goods-box"},[t("div",{staticClass:"cover-box"},[t("el-image",{staticClass:"cover-img",attrs:{fit:"contain",src:a.cover||r(36222)||""}})],1),t("div",{staticClass:"main-box"},[t("div",{staticClass:"cell-row"},[a|e.resourceTag?t("el-tag",{staticClass:"tag"},[e._v(e._s(e._f("resourceTag")(a)))]):e._e(),t("div",{staticClass:"title ou-expand ou-ellipsis"},[e._v(e._s(a.resourceName))])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:!!a.authorRecommendation,expression:"!!item.authorRecommendation"}],staticClass:"recommend ou-text-ellipsis-2"},[e._v(" "+e._s(a.authorRecommendation)+" ")]),t("el-form",{ref:"appRaiseForm",refInFor:!0,attrs:{model:e.appRaiseForm[s],rules:e.appRaiseRules,"label-suffix":": "}},[t("el-form-item",{staticClass:"rate-item",attrs:{label:"商品评分",prop:"rate"}},[t("el-rate",{attrs:{colors:["#D81E06","#D81E06","#D81E06"]},model:{value:e.appRaiseForm[s].rate,callback:function(t){e.$set(e.appRaiseForm[s],"rate",t)},expression:"appRaiseForm[index].rate"}})],1),t("el-form-item",{attrs:{prop:"content"}},[t("el-input",{attrs:{resize:"none",type:"textarea",rows:7,maxLength:201,placeholder:"请输入商品评价"},model:{value:e.appRaiseForm[s].content,callback:function(t){e.$set(e.appRaiseForm[s],"content",t)},expression:"appRaiseForm[index].content"}})],1)],1)],1)])})),0),t("div",{staticClass:"footer-wrap"},[t("el-button",{staticClass:"submit-btn",on:{click:e.handleSubmit}},[e._v("提交评价")])],1)])},s=[],o=(r(57658),r(54526)),i=r(57976),n=r(56695),u={name:"orderAppraise",components:{},data(){return{detail:{},goodsList:[],appRaiseForm:[],appRaiseRules:{rate:[{required:!0,trigger:"blur",message:"请选择评分"}],content:[{max:200,trigger:["blur","change"],message:"评价内容最多可输入200字"}]}}},watch:{},filters:{resourceTag(e){let t="-";return"subject"===e.sourceType?t="专题":"goods"===e.sourceType&&(t=e.sourceFile||""),t}},computed:{...(0,o.Se)(["userId"])},activated(){let{orderNumber:e}=this.$route.query;this.getOrderDetail(e)},mounted(){},beforeRouteEnter(e,t,r){r((e=>{if("/user/orderDetail/index"===t.path){let{orderNumber:t}=e.$route.query;e.getOrderDetail(t)}}))},methods:{getOrderDetail(e){(0,i.kx)({userId:this.userId,pageNum:1,pageSize:2,keyword:e}).then((e=>{let t=e.rows||[];t.length>=2&&(this.$message.error("获取详情失败，请稍后重试"),retrun),this.detail=t[0]||{};let r=this.detail.ocOrderChildList||[],a=[];r.forEach((e=>{a.push({rate:5,content:""})})),this.goodsList=r,this.appRaiseForm=a}))},handleSubmit(){let e=this.$refs.appRaiseForm,t=[],r=!1,a=0;e.forEach(((e,s)=>{e.validate().then((e=>{let r=this.goodsList[s],o=this.appRaiseForm[s];console.log("当前表单对象",r);let{relevanceId:i,orderId:n,sourceType:u}=r,{rate:c,content:l}=o,d={content:l,orderId:n,relevanceId:i,score:c,type:u};t.push(d),a++})).catch((()=>r=!0))}));let s=setInterval((()=>{if(a===e.length){if(clearInterval(s),r)return;(0,n.N4)(t).then((e=>{"已评价过这些商品"!==e.data?(this.$message.success("评价成功"),setTimeout((()=>{this.$router.push("/user/myEvaluate")}),1e3)):this.$message.error("已评价过此订单商品")}))}}),100)}}},c=u,l=r(1001),d=(0,l.Z)(c,a,s,!1,null,"428cfcf0",null),p=d.exports},56695:function(e,t,r){r.d(t,{N4:function(){return u},VJ:function(){return l},yv:function(){return c}});var a=r(84471),s=r(37182);const o=s.V+"/web/api/ocEvaluate/addEvaluate",i=s.V+"/web/api/ocEvaluate/del",n=s.V+"/web/api/ocEvaluate/list",u=(s.V,e=>(0,a.v_)(o,e)),c=e=>(0,a.U2)(n,e),l=e=>(0,a.ZP)({url:i,method:"delete",params:e})},57976:function(e,t,r){r.d(t,{Bl:function(){return v},Gn:function(){return f},HM:function(){return b},d5:function(){return w},eA:function(){return _},jH:function(){return R},jh:function(){return g},kx:function(){return h},y:function(){return x}});var a=r(84471),s=r(37182);const o=s.V+"/web/api/ocOrder/orderList",i=s.V+"/web/api/ocOrder/addOcOrder",n=s.V+"/web/api/ocOrder/addOcOrderSubject",u=(s.V,s.V+"/web/api/ocOrder/deleteById"),c=s.V+"/web/api/ocOrder/orderCountByStatus",l=s.V+"/web/api/ocOrder/updateOrderStatus",d=s.V+"/web/api/ocOrder/addOrderInMyResource",p=(s.V,s.V+"/web/IntegralRecord/list"),m=s.V+"/web/IntegralRecord/count",h=e=>(0,a.U2)(o,e),f=e=>(0,a.v_)(i,e),v=e=>(0,a.v_)(n,e),g=e=>(0,a.v_)(`${l}?id=${e.id}`),b=e=>(0,a.v_)(`${d}?id=${e.id}`),w=e=>(0,a.U2)(c,e),R=e=>(0,a.ZP)({url:u,method:"delete",params:e}),x=e=>(0,a.ZP)({url:p,method:"get",params:e}),_=e=>(0,a.ZP)({url:m,method:"get",params:e})},36222:function(e,t,r){e.exports=r.p+"img/default-bundle-cover.be06c906.png"}}]);
//# sourceMappingURL=2763.258105e4.js.map